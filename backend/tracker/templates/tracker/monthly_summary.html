<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Monthly Summary</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Monthly Summary</h2>
        <a href="/" class="btn btn-secondary">Back</a>
    </div>

    <!-- Year Selector -->
    <form method="get" class="mb-4">
        <label class="form-label">Select Year:</label>
        <select name="year" class="form-select w-25" onchange="this.form.submit()">
            {% for y in years %}
                <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>
                    {{ y }}
                </option>
            {% endfor %}
        </select>
    </form>

    <!-- Monthly Summary Table -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Month</th>
                <th>Total Income</th>
                <th>Total Expense</th>
                <th>Balance</th>
            </tr>
        </thead>
        <tbody>
            {% for row in summarys %}
            <tr>
                <td>{{ row.month|date:"F Y" }}</td>
                <td class="text-success">₹ {{ row.m_income }}</td>
                <td class="text-danger">₹ {{ row.m_expense }}</td>
                <td class="{% if row.balance >= 0 %}text-primary{% else %}text-danger{% endif %}">
                    ₹ {{ row.balance }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Chart -->
    <div class="card mt-4 p-3">
        <h5 class="text-center">Monthly Income vs Expense</h5>
        <canvas id="monthlyChart"></canvas>
    </div>

</div>

<script>
    const labels = [
        {% for row in summarys %}
            "{{ row.month|date:'M' }}",
        {% endfor %}
    ];

    const incomeData = [
        {% for row in summarys %}
            {{ row.m_income }},
        {% endfor %}
    ];

    const expenseData = [
        {% for row in summarys %}
            {{ row.m_expense }},
        {% endfor %}
    ];

    new Chart(document.getElementById('monthlyChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Income',
                    data: incomeData,
                    backgroundColor: 'rgba(25, 135, 84, 0.8)'
                },
                {
                    label: 'Expense',
                    data: expenseData,
                    backgroundColor: 'rgba(220, 53, 69, 0.8)'
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

</body>
</html>